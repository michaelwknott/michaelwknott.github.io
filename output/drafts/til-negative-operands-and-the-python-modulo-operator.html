<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>TIL: Negative Operands and the Python Modulo Operator</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Calculating the remainder using the Python modulo Operator with a negative operand">

        <meta name="author" content="Michael Knott">

        <meta name="tags" content="TIL">
        <meta name="tags" content="Python">
        <meta name="tags" content="modulo">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Michael Knott">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/michael-knott.html">
	<meta property="og:url" content="/drafts/til-negative-operands-and-the-python-modulo-operator.html">
	<meta property="og:title" content="TIL: Negative Operands and the Python Modulo Operator">
	<meta property="article:published_time" content="2023-06-30 14:30:00+01:00">
            <meta property="og:description" content="Calculating the remainder using the Python modulo Operator with a negative operand">

            <meta property="og:image" content="/static/cool-background-black.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@michaelwknott">
        <meta name="twitter:title" content="TIL: Negative Operands and the Python Modulo Operator">

            <meta name="twitter:image" content="/static/cool-background-black.png">

            <meta name="twitter:description" content="Calculating the remainder using the Python modulo Operator with a negative operand">
</head>

<body class="article-til-negative-operands-and-the-python-modulo-operator">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Michael Knott</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="/pages/about-me.html">About me</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/static/cool-background-black.png')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>TIL: Negative Operands and the Python Modulo Operator</h1>
                        <span class="meta">Posted by
                                <a href="/author/michael-knott.html">Michael Knott</a>
                             on Fri 30 June 2023
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h2>Using the Modulo Operator to evaluate</h2>
<p>The modulo operator behaves differently than I expected when passed a negative operand.</p>
<p>I've been using a fixed length Python list in a circular fashion as the underlying storage for my own implentation of a Deque. This means elements can wrap around the end of the list, ensuring time efficiency when adding elements to the front of the Deque (no need to shift each current element one place to the right) and space efficiency after adding and deleting multiple elements (avoiding the situation where there are a small number of elements in a list with a large capacity).</p>
<p>As long as I have a reference to the front of the list, the size of the list and know the list's capacity I can use the modulo operator to find the relevent list index to add or delete elements in the Deque.</p>
<p>The Deque implementation below shows the relevant instance varibles and the add_first() and _resize() methods that utilise the modulo operator.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nl">ArrayDeque</span><span class="p">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Deque implementation using a Python list as underlying storage.&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">DEFAULT_CAPACITY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">None</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ArrayDeque</span><span class="p">.</span><span class="n">DEFAULT_CAPACITY</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">deque</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">add_first</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_size</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="p">)</span><span class="err">:</span>
<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_resize</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="p">))</span>
<span class="w">        </span><span class="n">avail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_front</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="p">)</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="o">[</span><span class="n">avail</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">avail</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_size</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_resize</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="k">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_data</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">None</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">capacity</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_size</span><span class="p">)</span><span class="err">:</span>
<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">old</span><span class="o">[</span><span class="n">(self._front + i) % len(old)</span><span class="o">]</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_front</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>

<p>In the add_first() method I was the assuming <code>avail = (self._front - 1) % len(self._data)</code> would evaluate to -1.</p>
<div class="highlight"><pre><span></span><code># Incorrect understanding of modulo implementation

avail = (self._front - 1) % len(self._data)

avail = (0 - 1) % 10

avail = -1 % 10

avail = -1
</code></pre></div>

<p>However, Python's modulo implementation means <code>avail = (self._front - 1) % len(self._data)</code> evaluates to 9.</p>
<p>Due to negative indexing, this result didn't initially cause any issues as -1 and 9 both return the last element of the list (DEFAULT_CAPACIT = 10). However, this misunderstanding caused problems when I began to implement the _resize() method as I was working with the mental model that self._front referenced a negative integer. As I was using self._front in the expression <code>self._data[i] = old[(self._front + i) % len(old)]</code> to calculate an index value, this initially caused me issues.</p>
<h3>A correct mental model of modulo behaviour</h3>
<p>The _resize() method above shows the correct implementation of _resize() for my new understanding of how the modulo operator works. For future reference I've included the equation Python uses to for the modulo operator below:</p>
<div class="highlight"><pre><span></span><code>remainder = dividend % divisor

remainder = dividend - (divisor * (floor(dividend / divisor)))
</code></pre></div>

<div class="highlight"><pre><span></span><code># Correct understanding of modulo implementation

avail = (self._front - 1) % len(self._data)

avail = (0 - 1) % 10

avail = -1 - (10 * floor(-1 / 10))

avail = -1 - (10 * floor(-0.1))

avail = -1 - (10 * -1)

avail = -1 - -10

avail = 9
</code></pre></div>

<h3>A quick note on floor() function behaviour</h3>
<p>When passed a postive float, floor() tends towards zero. For example <code>floor(2.66)</code> returns 2.</p>
<p>When passed a negative float, floor() tends away from zerp. For example, <code>floor(-2.66)</code> returns -3.</p>
    </article>

        <div class="tags">
            <p>tags: <a href="/tag/til.html">TIL</a>, <a href="/tag/python.html">Python</a>, <a href="/tag/modulo.html">modulo</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/michaelwknott">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/michaelwknott">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.linkedin.com/in/michael-knott-a8005916/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Michael Knott
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>