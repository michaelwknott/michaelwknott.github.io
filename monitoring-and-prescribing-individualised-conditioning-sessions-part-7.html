<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Monitoring and Prescribing Individualised Conditioning Sessions: Part 7</title>

            <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Michael Knott Full Atom Feed" />
            <link href="/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Michael Knott Categories Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/tomorrow_night.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Implementing a Service Layer to Separate the Domain and presentation Layers">

        <meta name="author" content="Michael Knott">

        <meta name="tags" content="projects">
        <meta name="tags" content="esd">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Michael Knott">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/michael-knott.html">
	<meta property="og:url" content="/monitoring-and-prescribing-individualised-conditioning-sessions-part-7.html">
	<meta property="og:title" content="Monitoring and Prescribing Individualised Conditioning Sessions: Part 7">
	<meta property="article:published_time" content="2023-08-14 16:00:00+01:00">
            <meta property="og:description" content="Implementing a Service Layer to Separate the Domain and presentation Layers">

            <meta property="og:image" content="/static/cool-background-black.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@michaelwknott">
        <meta name="twitter:title" content="Monitoring and Prescribing Individualised Conditioning Sessions: Part 7">

            <meta name="twitter:image" content="/static/cool-background-black.png">

            <meta name="twitter:description" content="Implementing a Service Layer to Separate the Domain and presentation Layers">
</head>

<body class="article-monitoring-and-prescribing-individualised-conditioning-sessions-part-7">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Michael Knott</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="/pages/about.html">About</a></li>
                            <li><a href="/pages/reading-list.html">Reading List</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/static/cool-background-black.png')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Monitoring and Prescribing Individualised Conditioning Sessions: Part 7</h1>
                        <span class="meta">Posted by
                                <a href="/author/michael-knott.html">Michael Knott</a>
                             on Mon 14 August 2023
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>With the ability to communicate with the <a href="https://michaelwknott.github.io/monitoring-and-prescribing-individualised-conditioning-sessions-part-6.html">csv file persistence layer</a>, the next step in the project was to implement a service layer to make it easier to swap out presentation layers. The service layer achieves this by acting as an abstraction between the domain logic and the presentation layer. This means the presentation layer will communicate with the service layer to initiate the required domain logic and the service layer will communicate with the persistence layer to retrieve the necessary data.</p>
<h3>Creating an In-memory Repository to Test the Service Layer</h3>
<p>To make it easier to test the service layer I created concrete repositories for <code>FitnessProfile</code> and <code>Workout</code> domain entities. Although I currently only require read access to the persistence layer, using <code>FakeFitnessProfileRepository</code> and <code>FakeFitnessProfileRepository</code> avoids using data from the actual persistence layer (currently csv files). This would be more important if I was writing back to the persistence layer as using the production persistence layer for tests has the potential to affect the state of the application.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">esd.adapters.repository</span> <span class="kn">import</span> <span class="n">AbstractRepository</span>
<span class="kn">from</span> <span class="nn">esd.domain.athlete</span> <span class="kn">import</span> <span class="n">FitnessProfile</span>
<span class="kn">from</span> <span class="nn">esd.domain.session</span> <span class="kn">import</span> <span class="n">Workout</span>


<span class="k">class</span> <span class="nc">FakeFitnessProfileRepository</span><span class="p">(</span><span class="n">AbstractRepository</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fake implementation of FitnessProfile repository.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fitness_profiles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FitnessProfile</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise FakeFitnessProfileRepository with fitness profiles.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fitness_profiles</span> <span class="o">=</span> <span class="n">fitness_profiles</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FitnessProfile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single entity from the persistence layer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitness_profiles</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all entities from the persistence layer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fitness_profiles</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">FakeWorkoutRepository</span><span class="p">(</span><span class="n">AbstractRepository</span><span class="p">[</span><span class="n">Workout</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fake implementation of Workout repository.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workouts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Workout</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise FakeWorkoutRepository with workouts.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_workouts</span> <span class="o">=</span> <span class="n">workouts</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Workout</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single entity from the persistence layer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_workouts</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Workout</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all entities from the persistence layer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_workouts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div>

<h3>My First Use Case</h3>
<p>From my understanding the service layer contains all the functions or methods required to trigger the domain logic for a particular use case. As I mentioned in <a href="https://michaelwknott.github.io/monitoring-and-prescribing-individualised-conditioning-sessions-part-1.html">part 1</a>, my original plan was to create a PDF output of the individual work and rest interval distances for each athlete. However, to keep the project moving forward my first use case will provide output to the terminal using the <a href="https://rich.readthedocs.io/en/stable/introduction.html">Rich</a> package. I made this decision as I haven't previously used packages for creating PDFs and I have familiarity with Rich which allowed me to maintain project momentum. The <a href="https://github.com/michaelwknott/esd/issues/32">PDF functionality</a> will be added at a later date. </p>
<p>So for now, my use case is as follows:</p>
<p>A coach wants to prescribe individual conditioning workouts for their athletes. They use a CLI tool to select a workout and receive work and rest interval distances for each individual athlete as output in the console. The coach can then use this information to set up the workout.</p>
<h3>Creating the Service Layer</h3>
<p>To achieve the first use case requires a number of steps:</p>
<ol>
<li>Get the required <code>Workout object</code></li>
<li>Get the required <code>FitnessProfiles</code></li>
<li>Calculate the individual work and rest interval distances using the <code>Workout</code> and <code>FitnessProfile</code> objects</li>
<li>Return an output in the terminal that shows work and rest interval distances for each athlete</li>
</ol>
<p>For steps 1 and 2 I needed to be able to communicate with the persistance layer. To achieve this the  <code>WorkoutService</code> <code>__init__</code> method  initialises the <code>workout_repository</code> and <code>fitness_profile_repository</code> attributes with class instances that implements the <code>AbstractRepository</code> interface for <code>Workout</code> and <code>FitnessProfile</code> objects.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">WorkoutService</span><span class="p">:</span>
<span class="sd">&quot;&quot;&quot;Service class for workout related operations.&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">workout_repository</span><span class="p">:</span> <span class="n">AbstractRepository</span><span class="p">[</span><span class="n">Workout</span><span class="p">],</span>
    <span class="n">fitness_profile_repository</span><span class="p">:</span> <span class="n">AbstractRepository</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise WorkoutService with repositories.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">workout_repository</span> <span class="o">=</span> <span class="n">workout_repository</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitness_profile_repository</span> <span class="o">=</span> <span class="n">fitness_profile_repository</span>
</code></pre></div>

<p>To get the required workout I created a <code>get_workout</code> method that calls the <code>workout_repository</code> <code>get</code> method to return a single <code>Workout</code> entity. The <code>Workout</code> object contains the training variables which will be used along each athlete's <code>FitnessProfile</code> to calculate individual work and rest interval distances. The calculations multiply an athlete's Maximum Aerobic Speed (MAS) in meters per second by the work or rest interval time in seconds. As the <code>Workout</code> object contains work and rest interval times in minutes I also created a helper function to convert minutes to seconds. </p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">WorkoutService</span><span class="p">:</span>
<span class="sd">&quot;&quot;&quot;Service class for workout related operations.&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">workout_repository</span><span class="p">:</span> <span class="n">AbstractRepository</span><span class="p">[</span><span class="n">Workout</span><span class="p">],</span>
    <span class="n">fitness_profile_repository</span><span class="p">:</span> <span class="n">AbstractRepository</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise WorkoutService with repositories.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">workout_repository</span> <span class="o">=</span> <span class="n">workout_repository</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitness_profile_repository</span> <span class="o">=</span> <span class="n">fitness_profile_repository</span>

<span class="k">def</span> <span class="nf">get_workout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Workout</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a workout from the repository.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A workout.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">workout_repository</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_convert_minutes_to_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work_interval_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert minutes to seconds.</span>

<span class="sd">    Args:</span>
<span class="sd">        work_interval_time: The work interval time in minutes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The work interval time in seconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">work_interval_time</span> <span class="o">*</span> <span class="mi">60</span>
</code></pre></div>

<p>To get the required <code>FitnessProfiles</code> I created a <code>get_fitness_profiles</code> method which calls the <code>get_all()</code> method from the <code>fitness_profile_repository</code>. This return a list of <code>FitnessProfiles</code> which will be used alongside the <code>Workout</code> object to calculate the individual work and rest interval distances.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">WorkoutService</span><span class="p">:</span>
<span class="sd">&quot;&quot;&quot;Service class for workout related operations.&quot;&quot;&quot;</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">get_fitness_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all fitness profiles from the repository.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of fitness profiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_profile_repository</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>
</code></pre></div>

<p>The previous steps have collected the required data. Step 3 uses this data to calculate the individual work and rest interval distances. I've taken the <code>calculate_work_interval_distances</code> and <code>calculate_rest_interval_distances</code> functions that was previously in the domain model and moved them into the service layer.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">WorkoutService</span><span class="p">:</span>
<span class="sd">&quot;&quot;&quot;Service class for workout related operations.&quot;&quot;&quot;</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">_calculate_work_interval_distances</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">,</span> <span class="n">fitness_profiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate work interval distances for each athlete.</span>

<span class="sd">    Args:</span>
<span class="sd">        workout: The training variables for the workout.</span>
<span class="sd">        fitness_profiles: The fitness profile for each athlete completing the</span>
<span class="sd">            workout.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of athlete names mapped to work interval distances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">work_distances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">fitness_profiles</span><span class="p">:</span>
        <span class="n">work_interval_mas</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">max_aerobic_speed</span> <span class="o">*</span> <span class="n">workout</span><span class="o">.</span><span class="n">work_interval_percentage_mas</span>
        <span class="p">)</span>
        <span class="n">work_interval_distance</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
            <span class="n">work_interval_mas</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_minutes_to_seconds</span><span class="p">(</span><span class="n">workout</span><span class="o">.</span><span class="n">work_interval_time</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">work_distances</span><span class="p">[</span><span class="n">profile</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">work_interval_distance</span>
    <span class="k">return</span> <span class="n">work_distances</span>

<span class="k">def</span> <span class="nf">_calculate_rest_interval_distances</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">,</span> <span class="n">fitness_profiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate rest interval distances for each athlete.</span>

<span class="sd">    Args:</span>
<span class="sd">        workout: The training variables for the workout.</span>
<span class="sd">        fitness_profiles: The fitness profile for each athlete completing the</span>
<span class="sd">            workout.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of athlete names mapped to rest interval distances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rest_distances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">fitness_profiles</span><span class="p">:</span>
        <span class="n">rest_interval_mas</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">max_aerobic_speed</span> <span class="o">*</span> <span class="n">workout</span><span class="o">.</span><span class="n">rest_interval_percentage_mas</span>
        <span class="p">)</span>
        <span class="n">rest_interval_distance</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
            <span class="n">rest_interval_mas</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_minutes_to_seconds</span><span class="p">(</span><span class="n">workout</span><span class="o">.</span><span class="n">rest_interval_time</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">rest_distances</span><span class="p">[</span><span class="n">profile</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest_interval_distance</span>
    <span class="k">return</span> <span class="n">rest_distances</span>
</code></pre></div>

<p>The methods have an underscore suffix as they will be called internally by <code>print_workout_table</code>. This method provides the functionality to print a table containing athlete's names, work interval distances and rest interval distances to the terminal.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">print_workout_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">,</span> <span class="n">fitness_profiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FitnessProfile</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print a table of names, work interval and rest interval distances.</span>

<span class="sd">    Args:</span>
<span class="sd">        workout: The training variables for the workout.</span>
<span class="sd">        fitness_profiles: The fitness profile for each athlete completing the</span>
<span class="sd">            workout.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">work_distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_work_interval_distances</span><span class="p">(</span>
        <span class="n">workout</span><span class="p">,</span> <span class="n">fitness_profiles</span>
    <span class="p">)</span>
    <span class="n">rest_distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_rest_interval_distances</span><span class="p">(</span>
        <span class="n">workout</span><span class="p">,</span> <span class="n">fitness_profiles</span>
    <span class="p">)</span>

    <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">workout</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Athlete Name&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Work Distance (m)&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Rest Distance (m)&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">athlete</span> <span class="ow">in</span> <span class="n">work_distances</span><span class="p">:</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
            <span class="n">athlete</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">work_distances</span><span class="p">[</span><span class="n">athlete</span><span class="p">]</span><span class="si">}</span><span class="s2">m&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rest_distances</span><span class="p">[</span><span class="n">athlete</span><span class="p">]</span><span class="si">}</span><span class="s2">m&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span>
</code></pre></div>

<p>The service layer now has the required functionality to meet my first use case. The next step is to create a presentation layer that accepts user input and communicates with the service layer to create  the required output.</p>
<h3>The Complete <code>WorkoutService</code> Implementation</h3>
<p>For completeness I've included the full implementation below.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</code></pre></div>

<p>from rich.console import Console
from rich.table import Table</p>
<p>from esd.adapters.repository import AbstractRepository
from esd.domain.athlete import FitnessProfile
from esd.domain.session import Workout</p>
<p>class WorkoutService:
    """Service class for workout related operations."""</p>
<div class="highlight"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span>
<span class="w">    </span><span class="n">self</span><span class="p">,</span>
<span class="w">    </span><span class="nl">workout_repository</span><span class="p">:</span><span class="w"> </span><span class="n">AbstractRepository</span><span class="o">[</span><span class="n">Workout</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="nl">fitness_profile_repository</span><span class="p">:</span><span class="w"> </span><span class="n">AbstractRepository</span><span class="o">[</span><span class="n">FitnessProfile</span><span class="o">]</span><span class="p">,</span>
<span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Initialise WorkoutService with repositories.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">workout_repository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">workout_repository</span>
<span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">fitness_profile_repository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fitness_profile_repository</span>

<span class="n">def</span><span class="w"> </span><span class="n">_convert_minutes_to_seconds</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">work_interval_time</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">int</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Convert minutes to seconds.</span>

<span class="ss">    Args:</span>
<span class="ss">        work_interval_time: The work interval time in minutes.</span>

<span class="ss">    Returns:</span>
<span class="ss">        The work interval time in seconds.</span>
<span class="ss">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">work_interval_time</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span>

<span class="n">def</span><span class="w"> </span><span class="n">get_workout</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">id</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">Workout</span><span class="p">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Get a workout from the repository.</span>

<span class="ss">    Returns:</span>
<span class="ss">        A workout.</span>
<span class="ss">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">workout_repository</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

<span class="n">def</span><span class="w"> </span><span class="n">get_fitness_profiles</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">list</span><span class="o">[</span><span class="n">FitnessProfile</span><span class="o">]</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Get all fitness profiles from the repository.</span>

<span class="ss">    Returns:</span>
<span class="ss">        A list of fitness profiles.</span>
<span class="ss">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">fitness_profile_repository</span><span class="p">.</span><span class="n">get_all</span><span class="p">()</span>

<span class="n">def</span><span class="w"> </span><span class="n">_calculate_work_interval_distances</span><span class="p">(</span>
<span class="w">    </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">workout</span><span class="p">:</span><span class="w"> </span><span class="n">Workout</span><span class="p">,</span><span class="w"> </span><span class="nl">fitness_profiles</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="o">[</span><span class="n">FitnessProfile</span><span class="o">]</span>
<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">dict</span><span class="o">[</span><span class="n">str, float</span><span class="o">]</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Calculate work interval distances for each athlete.</span>

<span class="ss">    Args:</span>
<span class="ss">        workout: The training variables for the workout.</span>
<span class="ss">        fitness_profiles: The fitness profile for each athlete completing the</span>
<span class="ss">            workout.</span>

<span class="ss">    Returns:</span>
<span class="ss">        A dictionary of athlete names mapped to work interval distances.</span>
<span class="ss">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">work_distances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">fitness_profiles</span><span class="p">:</span>
<span class="w">        </span><span class="n">work_interval_mas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">profile</span><span class="p">.</span><span class="n">max_aerobic_speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">workout</span><span class="p">.</span><span class="n">work_interval_percentage_mas</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">work_interval_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span>
<span class="w">            </span><span class="n">work_interval_mas</span>
<span class="w">            </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_convert_minutes_to_seconds</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">work_interval_time</span><span class="p">),</span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">work_distances</span><span class="o">[</span><span class="n">profile.name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work_interval_distance</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">work_distances</span>

<span class="n">def</span><span class="w"> </span><span class="n">_calculate_rest_interval_distances</span><span class="p">(</span>
<span class="w">    </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">workout</span><span class="p">:</span><span class="w"> </span><span class="n">Workout</span><span class="p">,</span><span class="w"> </span><span class="nl">fitness_profiles</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="o">[</span><span class="n">FitnessProfile</span><span class="o">]</span>
<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">dict</span><span class="o">[</span><span class="n">str, float</span><span class="o">]</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Calculate rest interval distances for each athlete.</span>

<span class="ss">    Args:</span>
<span class="ss">        workout: The training variables for the workout.</span>
<span class="ss">        fitness_profiles: The fitness profile for each athlete completing the</span>
<span class="ss">            workout.</span>

<span class="ss">    Returns:</span>
<span class="ss">        A dictionary of athlete names mapped to rest interval distances.</span>
<span class="ss">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">rest_distances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">profile</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">fitness_profiles</span><span class="p">:</span>
<span class="w">        </span><span class="n">rest_interval_mas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="n">profile</span><span class="p">.</span><span class="n">max_aerobic_speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">workout</span><span class="p">.</span><span class="n">rest_interval_percentage_mas</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">rest_interval_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span>
<span class="w">            </span><span class="n">rest_interval_mas</span>
<span class="w">            </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_convert_minutes_to_seconds</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">rest_interval_time</span><span class="p">),</span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="n">rest_distances</span><span class="o">[</span><span class="n">profile.name</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rest_interval_distance</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rest_distances</span>

<span class="n">def</span><span class="w"> </span><span class="n">print_workout_table</span><span class="p">(</span>
<span class="w">    </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">workout</span><span class="p">:</span><span class="w"> </span><span class="n">Workout</span><span class="p">,</span><span class="w"> </span><span class="nl">fitness_profiles</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="o">[</span><span class="n">FitnessProfile</span><span class="o">]</span>
<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Table</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Print a table of names, work interval and rest interval distances.</span>

<span class="ss">    Args:</span>
<span class="ss">        workout: The training variables for the workout.</span>
<span class="ss">        fitness_profiles: The fitness profile for each athlete completing the</span>
<span class="ss">            workout.</span>
<span class="ss">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">work_distances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_calculate_work_interval_distances</span><span class="p">(</span>
<span class="w">        </span><span class="n">workout</span><span class="p">,</span><span class="w"> </span><span class="n">fitness_profiles</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">rest_distances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_calculate_rest_interval_distances</span><span class="p">(</span>
<span class="w">        </span><span class="n">workout</span><span class="p">,</span><span class="w"> </span><span class="n">fitness_profiles</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">console</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Console</span><span class="p">()</span>
<span class="w">    </span><span class="nc">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="ss">&quot;%d/%m/%Y&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nc">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">f</span><span class="ss">&quot;{workout.name} - {date}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nc">table</span><span class="p">.</span><span class="n">add_column</span><span class="p">(</span><span class="ss">&quot;Athlete Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">justify</span><span class="o">=</span><span class="ss">&quot;left&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nc">table</span><span class="p">.</span><span class="n">add_column</span><span class="p">(</span><span class="ss">&quot;Work Distance (m)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">justify</span><span class="o">=</span><span class="ss">&quot;center&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nc">table</span><span class="p">.</span><span class="n">add_column</span><span class="p">(</span><span class="ss">&quot;Rest Distance (m)&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">justify</span><span class="o">=</span><span class="ss">&quot;center&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">athlete</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">work_distances</span><span class="p">:</span>
<span class="w">        </span><span class="nc">table</span><span class="p">.</span><span class="n">add_row</span><span class="p">(</span>
<span class="w">            </span><span class="n">athlete</span><span class="p">,</span>
<span class="w">            </span><span class="n">f</span><span class="ss">&quot;{work_distances[athlete]}m&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">f</span><span class="ss">&quot;{rest_distances[athlete]}m&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="k">print</span><span class="p">(</span><span class="nc">table</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nc">table</span>
</code></pre></div>
    </article>

        <div class="tags">
            <p>tags: <a href="/tag/projects.html">projects</a>, <a href="/tag/esd.html">esd</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/michaelwknott">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/michaelwknott">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.linkedin.com/in/michael-knott-a8005916/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Michael Knott
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>